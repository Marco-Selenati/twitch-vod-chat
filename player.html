<html>

	<head>
		<title>braxen's vod replay</title>
		<link href="https://cdn.betterttv.net/betterttv.css" type="text/css" rel="stylesheet" />
	</head>
	
	<body>

		<div id="player">

			<video id="video"></video>

			<div id="comments" class="left has-gradient has-stroke">
				<div class="comment">
					<span class="time">[00:00:00]</span>
					<span class="name">Username:</span>
					<span class="body">Body text</span>
				</div>
			</div>

			<div id="osd">SYNC NOT STARTED</div>

		</div>

		<div id="timeline">
			00:00:00
		</div>

		<div id="controls">

			<div class="option-row">
				
				<div class="option-group" id="option-group-video">
					<h2>Video</h2>
					<input type="file" id="inputVideo" accept="video/*" onchange="vodplayer.load(event, 'video'); return false;" />
					<p class="help-text">
						These files will not be uploaded to anywhere, they're played on your device locally.
					</p>
				</div>

				<div class="option-group" id="option-group-chat">
					<h2>Chat</h2>
					<input type="file" id="inputChat" accept="application/json" onchange="vodplayer.load(event, 'chat'); return false;" />
					<p class="help-text">
						Chat logs may take a while to parse, don't worry.
					</p>
				</div>

				<div class="option-group">
					<strong>Video:</strong> <span id="status-text-video">Waiting</span><br>
					<strong>Comments:</strong> <span id="status-text-comments">Waiting</span><br>
					<strong>FFZ:</strong> <span id="status-text-ffz">Waiting</span><br>
					<strong>BTTV Channel:</strong> <span id="status-text-bttv_channel">Waiting</span><br>
					<strong>BTTV Global:</strong> <span id="status-text-bttv_global">Waiting</span>
				</div>

			</div>

			<div class="option-row">

				<div class="option-group">
					<h2>Chat offset in seconds</h2>
					<p class="help-text">
						Offset from the video, if recording started too late.
						It will be set automatically based on how long the chat dump is
						and the video length, remember to set it to 0 if you want it that way.
					</p>
					<input id="optionOffset" value="0">
				</div>

				<div class="option-group">
					<h2>Chat timescale</h2>
					<p class="help-text">
						1 is standard, 2 is twice as fast etc.
						Slow the captured video down with this amount to reduce live recording time
					</p>
					<input id="optionTimescale" value="1">
				</div>

				<div class="option-group">
					<h2>Update frequency in ms</h2>
					<p class="help-text">
						The lower the smoother. 16.67 - 60fps, 33.33 - 30fps.
						Missed ticks shouldn't matter, as the parser is dependent on system time.
					</p>
					<input id="optionTickDelay" value="300">
				</div>

				<div class="option-group">
					<h2>Chat location</h2>
					<p class="help-text">
						This can be changed at any time, if it's in the way of something in the VOD.
					</p>
					<button onclick="vodplayer.alignChat('left')">Left</button>
					<button onclick="vodplayer.alignChat('right')">Right</button>
					<label><input type="range" min="0" max="100" value="0" id="optionChatTop"> Top</label>
					<label><input type="range" min="0" max="100" value="0" id="optionChatBottom"> Bottom</label>
				</div>

				<div class="option-group">
					<h2>Chat style</h2>
					<select id="optionChatStyle">
						<option value="has-gradient">Gradient</option>
						<option value="has-fill">Fill</option>
						<option value="">None</option>
					</select><br>

					<label><input type="checkbox" checked="checked" id="optionChatStroke"> Stroke</label>
					<label><input type="checkbox" checked="checked" id="optionChatEmotes"> Emotes</label><br>
					<label><input type="checkbox" checked="checked" id="optionChatTimestamps"> Timestamps</label>
					<label><input type="checkbox" checked="checked" id="optionChatBadges"> Badges</label>

					<p class="help-text">
						These will only apply to newly displayed messages.
					</p>

				</div>

			</div>

			<div class="option-group">
				<button onclick="vodplayer.play()" id="buttonStart">Start</button>
				<button onclick="vodplayer.apply()" id="buttonApply">Apply</button>
				<button onclick="vodplayer.fullscreen()" id="buttonFullscreen">Fullscreen</button>
			</div>

		</div>

		<script src="vodplayer.js"></script>

		<script>

			'use strict';

			const vodplayer = new VODPlayer();

			vodplayer.elements.player 	= document.getElementById('player');
			vodplayer.elements.video 	= document.getElementById('video');
			vodplayer.elements.comments = document.getElementById('comments');
			vodplayer.elements.osd 		= document.getElementById('osd');
			vodplayer.elements.timeline = document.getElementById('timeline');

			vodplayer.hooks();

			console.log(vodplayer);

			String.prototype.replaceAll = function(search, replacement) {
				var target = this;
				search = search.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // escape regex
				return target.replace(new RegExp(search, 'g'), replacement);
			};

			// chat style
			document.getElementById('optionChatStyle').addEventListener('change', function(ev){
				console.log('Set chat style');
				vodplayer.elements.comments.classList.remove('has-gradient', 'has-fill');
				if( ev.target.value ) vodplayer.elements.comments.classList.add( ev.target.value );
			});

			document.getElementById('optionChatStroke').addEventListener('change', function(ev){
				console.log('Set chat stroke');
				vodplayer.elements.comments.classList.toggle('has-stroke', ev.target.checked);
			});

			document.getElementById('optionChatEmotes').addEventListener('change', function(ev){
				console.log('Set chat emotes');
				vodplayer.emotesEnabled = ev.target.checked;
			});

			document.getElementById('optionChatTimestamps').addEventListener('change', function(ev){
				console.log('Set chat timestamps');
				vodplayer.timestampsEnabled = ev.target.checked;
			});

			document.getElementById('optionChatBadges').addEventListener('change', function(ev){
				console.log('Set chat badges');
				vodplayer.badgesEnabled = ev.target.checked;
			});

			document.getElementById('optionChatTop').addEventListener('change', function(ev){
				console.log('Set chat top');
				vodplayer.chatTop = ev.target.value;
			});

			document.getElementById('optionChatBottom').addEventListener('change', function(ev){
				console.log('Set chat bottom');
				vodplayer.chatBottom = ev.target.value;
			});

		</script>

		<style>

			@keyframes fade {
				0% { opacity: 0; }
				100% { opacity: 1; }
			}

			* { box-sizing: border-box; }

			body {

				font: 12px 'Open Sans', 'Arial';
				
				height: 100%;
				margin: 0;
				padding: 0;
				/* background: #0f0; */
				background: #111;
			}

			#comments {

				padding: 5px;

				font-size: 12px;
				color: #fff;

				/* height: 100%; */
				width: 25%;
				overflow: hidden;

				position: absolute;
				top: 0%;
				bottom: 0%;

				pointer-events: none;
				
			}

			#comments.left {
				top: 0px;
				left: 0px;				
			}

			#comments.right {
				top: 0px;
				right: 0px;
				text-align: right;
			}

			#comments.left.has-gradient {
				/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#000000+0,7db9e8+100&1+0,0+100 */
				background: -moz-linear-gradient(left, rgba(0,0,0,0.7) 0%, rgba(125,185,232,0) 100%); /* FF3.6-15 */
				background: -webkit-linear-gradient(left, rgba(0,0,0,0.7) 0%,rgba(125,185,232,0) 100%); /* Chrome10-25,Safari5.1-6 */
				background: linear-gradient(to right, rgba(0,0,0,0.7) 0%,rgba(125,185,232,0) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
			}

			#comments.right.has-gradient {
				/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#000000+0,7db9e8+100&1+0,0+100 */
				background: -moz-linear-gradient(right, rgba(0,0,0,0.7) 0%, rgba(125,185,232,0) 100%); /* FF3.6-15 */
				background: -webkit-linear-gradient(right, rgba(0,0,0,0.7) 0%,rgba(125,185,232,0) 100%); /* Chrome10-25,Safari5.1-6 */
				background: linear-gradient(to left, rgba(0,0,0,0.7) 0%,rgba(125,185,232,0) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
			}

			#comments.has-fill {
				background: rgba(0, 0, 0, .4);
			}

			#comments .comment {
				min-height: 20px;
				/* animation: fade 0.2s; */
			}

			#comments.has-stroke .comment {
				text-shadow:
				    -1px -1px 0 #111,  
				    1px -1px 0 #111,
				    -1px 1px 0 #111,
				    1px 1px 0 #111,
				1px 1px 3px rgba(0,0,0,.7);
			}

			#comments span {
				padding: 0 1px;
			}

			#comments .time {
				color: #aaa;
			}

			#comments .badge {
				display: inline-block;
				font-weight: 700;
				color: #eee;
				padding: 0 3px;
				background: #832B2B;
				border-radius: 3px;
				margin: 0 2px;
			}

			#comments .badge.premium {
				background: #427EBC;
			}

			#comments .name {
				font-weight: 700;
				color: #ccc;
			}

			#comments .emote {
				max-height: 32px;
			}

			#comments img {
				vertical-align: middle;
			}

			#player {
				width: 1280px;
				height: 720px;
				position: relative;
				/* margin: auto; */
			}

			#player:fullscreen {
				width: 100%;
				height: 100%;
			}

			#video {
				width: 100%;
				height: 100%;
				/* background: #3D4470; */
				background: #f0f;
			}

			#osd {
				display: none;
				position: absolute;
				left: 640px;
				top: 360px;
				background: #f00;
				color: #fff;
				padding: 10px;
				font-family: Consolas, monospace;
			}

			#osd.running {
				background: #00f;
			}

			#controls {
				width: 1280px;
			}

			.option-row {
				display: flex;
			}

			.option-row .option-group {
				flex-grow: 1;
				flex-basis: 33%;
			}

			.option-group {

				margin: 3px;
				padding: 5px;

				border: 1px solid #666;
				background: #222;
				color: #ccc;

			}

			.option-group.ok {
				background: #3B5134;
				border-color: #5D963A;
			}

			.option-group h2 {
				font-size: 16px;
				margin: 0;
				padding: 0 0 1px 0;
			}

			#timeline {
				font-size: 14px;
				font-weight: 700;
				width: 1280px;
				padding: 5px;
				background: #222;
				color: #fff;
			}

			.help-text {
				color: #aaa;
				font-weight: 300;
				font-size: 90%;
			}

			button {
				background: #555;
				border: 1px solid #666;
				color: #ccc;
				padding: 4px 15px;
			}

			button:not(:disabled):hover {
				background: #666;
				border-color: #999;
				color: #fff;
				cursor: pointer;
			}

			button:disabled {
				color: #777;
				cursor: not-allowed;
			}

			input {
				background: #555;
				border: 1px solid #717171;
				color: #ccc;
				padding: 3px 6px;
				margin: 0;
			}

			input:focus {
				border-color: #999;
				color: #fff;
			}

			p {
				margin: 3px 0;
				padding: 0;
			}

		</style>

	</body>

</html>